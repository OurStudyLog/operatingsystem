생성일 | 2024.01.10
작성자 | 이지현
# 08-2 다양한 입출력 방법

### 요약
- 장치 컨트롤러가 CPU와 정보를 주고 받는 방법
- 프로그램 입출력은 프로그램 속 명령어로 입출력 작업을 하는 방식이다.
- 메모리 맵 입출력은 메모리에 접근하기 위한 주소 공간과 입출력장치에 접근하기 위한주소 공간을 하나의 주소 공간으로 간주하는 입출력 방식이다.
- 고립형 입출력은 메모리에 접근하기 위한 주소 공간과 입출력장치에 접근하기 위한 주소 공간을 별도로 분리하는 입출력 방식이다.
- 인터럽트 기반 입출력은 인터럽트로써 입출력을 수행하는 방법이다.
- DMA 입출력은 CPU를 거치지 않고 메모리와 입출력장치 간의 데이터를 주고받는 입출력 방식이다.
- 입출력 버스는 입출력장치와 컴퓨터 내부를 연결 짓는 통로로, 입출력 작업 과정에서 시스템 버스 사용 횟수를 줄여준다.

---
## 프로그램 입출력

기본적으로 프로그램 속 명령어로 입출력장치를 제어하는 방법

### 메모리에 저장된 정보를 하드 디스크에 백업하는 상황
1. 하드 디스크에 새로운 정보를 쓴다. -> CPU는 하드 디스크 컨트롤러의 제어 레지스터에 쓰기 명령을 보낸다.
2. 하드 디스크 컨트롤러는 하드 디스크 상태를 확인, 하드 디스크가 준비된 상태라면 하드 디스크 컨트롤러는 상태 레지스터에 준비되었다고 표시
3. CPU는 상태 레지스터를 주기적으로 읽어보며 하드 디스크의 준비 여부를 확인, 하드 디스크가 준비됐음을 CPU가 알게 되면 백업할 메모리의 정보를 데이터 레지스터에 쓴다.

CPU는 장치 컨트롤러의 레지스터들을 어떻게 아는 걸까?
- 메모리 맵 입출력 : 메모리에 접근하기 위한 주소 공간과 입출력장치에 접근하기 위한 주소 공간을 하나의 주소 공간으로 간주하는 방법
- 고립형 입출력: 메모리를 위한 주소 공간과 입출력장치를 위한 주소 공간을 분리하는 방법

| 메모리 맵 입출력 | 고립형 입출력 |
| ---- | ---- |
| 메모리와 입출력장치는 같은 주소 공간 사용 | 메모리와 입출력장치는 분리된 주소 공간 사용 |
| 메모리 주소 공간이 축소됨 | 메모리 주소 공간이 축소되지 않음 |
| 메모리와 입출력장치에 같은 명령어 사용 가능 | 입출력 전용 명령어 사용 |
 
---
## 인터럽트 기반 입출력

> CPU가 입출력장치에 처리할 내용을 명령하면 입출력장치가 명령어를 수행하는 동안 CPU는 다른 일을 할 수 있다.

> 입출력장치가 CPU에게 인터럽트 요청 신호를 보내면 CPU는 하던 일을 잠시 멈추고 해당 인터럽트를 처리하는 프로그램인 인터럽트 서비스 루틴을 실행한 뒤 다시 하던 일로 되돌아온다. 

입출력장치에 의한 하드웨어 인터럽트는 정확하게는 입출력장치가 아닌 장치 컨트롤러에 의해 발생.
CPU는 장치 컨트롤러에 입출력 작업을 명령하고, 장치 컨트롤러가 입출력장치를 제어하며 입출력을 수행하는 동안 CPU는 다른 일을 할 수 있다.
장치 컨트롤러가 입출력 작업을 끝낸 뒤 CPU에게 인터럽트 요청 신호를 보내면 CPU는 하던 일을 잠시 백업하고 인터럽트 서비스 루틴을 실행한다.

> [!폴링]
> 입출력장치의 상태는 어떤지, 처리할 데이터가 있는지를 주기적으로 확인하는 방식. 인터럽트 방식보다 CPU의 부담이 더 크다.

- NMI(Non-Maskable Interrupt):  인터럽트 비트를 비활성화해도 무시할 수 없는 인터럽트

다중 인터럽트 처리 방법
- CPU는 우선순위가 높은 인터럽트부터 처리한다.
- 프로그래머블 인터럽트 컨트롤러(PIC: Programmable Interrupt Controller): 여러 장치 컨트롤러에 연결되어 장치 컨틀로러에서 보낸 하드웨어 인터럽트 요청들의 우선순위를 판별한 뒤 CPU에 지금 처리해야 할 하드웨어 인터럽트는 무엇인지 알려주는 장치
	- PIC의 다중 인터럽트 처리 과정
		1. PIC가 장치 컨트롤러에서 인터럽트 요청 신호를 받아들인다.
		2. PIC는 인터럽트 우선순위를 판단한 뒤 CPU에 처리해야 할 인터럽트 요청 신호를 보낸다.
		3. CPU는 PIC에 인터럽트 확인 신호를 보낸다.
		4. PIC는 데이터 버스를 통해 CPU에 인터럽트 벡터를 보낸다.
		5. CPU는 인터럽트 벡터를 통해 인터럽트 요청의 주체를 알게 되고, 해당 장치의 인터럽트 서비스 루틴을 실행한다.

프로그램 기반 입출력과 인터럽트 기반 입출력의 공통점:
입출력 장치와 메모리 간의 데이터 이동은 CPU가 주도하고 이동하는 데이터도 반드시 CPU를 거친다. 즉, CPU의 부담이 크다.

---
## DMA 입출력

입출력장치와 메모리가 CPU를 거치지 않고도 상호작용할 수 있는 입출력 방식으로 직접 메모리에 접근할 수 있는 입출력 방식.
이를 위해 시스템 버스에 연결된 DMA 컨트롤러라는 하드웨어가 필요하다.

### DMA 입출력 과정
1. CPU는 DMA 컨트롤러에 입출력장치의 주소, 수행하 연산(읽기/쓰기), 읽거나 쓸 메모리의 주소 등과 같은 정보로 입출력 작업을 명령한다.
2. DMA 컨트롤러는 CPU 대신 장치 컨트롤러와 상호작용하며 입출력 작업을 수행한다. 이때 DMA 컨트롤러는 필요한 경우 메모리에 직접 접근하여 정보를 읽거나 쓴다.
3. 입출력 작업이 끝나면 DMA 컨트롤러는 CPU에 인터럽트를 걸어작업이 끝났음을 알린다.

단점
- 시스템 버스는 동시 사용이 불가능하다. 즉, CPU가 시스템 버스를 사용할 때 DMA 컨트롤러는 시스템 버스를 사용할 수 없고, 반대의 경우도 마찬가지.

따라서 DMA 컨트롤러는 CPU가 시스템 버스를 이용하지 않을 때마다 조금씩 시스템 버스를 이용하거나, CPU에게 허락을 구하고 집중적으로 이용한다. - 사이클 스틸링(cycle stealing)

### 입출력 버스

DMA를 위해 시스템 버스를 너무 자주 사용하면 그만큼 CPU가 시스템 버스를 이용하지 못하므로, 별도의 버스(입출력 버스)에 연결하여 해결한다.
DMA 컨트롤러와 장치 컨트롤러가 서로 데이터를 전송할 때는 시스템 버스를 이용할 필요가 없으므로 시스템 버스의 사용 빈도를 줄일 수 있다.

현대 대부분의 컴퓨터에는 입출력 버스가 있다. 즉, 대부분의 입출력장치(장치 컨트롤러)는 시스템 버스가 아닌 입출력 버스와 연결된다.

입출력 버스의 종류
- PCI(Peripheral Component Interconnect) 버스
- PCI Express (PCIe) 버스

----
### 퀴즈

디스커션 링크:

